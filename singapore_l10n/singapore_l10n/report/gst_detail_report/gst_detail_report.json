{
 "add_total_row": 0,
 "columns": [],
 "creation": "2022-07-30 13:57:42.466468",
 "disable_prepared_report": 0,
 "disabled": 0,
 "docstatus": 0,
 "doctype": "Report",
 "filters": [
  {
   "fieldname": "company",
   "fieldtype": "Link",
   "label": "Company",
   "mandatory": 0,
   "options": "Company",
   "wildcard_filter": 0
  },
  {
   "fieldname": "from_date",
   "fieldtype": "Date",
   "label": "Start End",
   "mandatory": 0,
   "wildcard_filter": 0
  },
  {
   "fieldname": "to_date",
   "fieldtype": "Date",
   "label": "End Date",
   "mandatory": 0,
   "wildcard_filter": 0
  }
 ],
 "idx": 0,
 "is_standard": "Yes",
 "javascript": "",
 "letter_head": "",
 "modified": "2022-09-15 18:08:06.591399",
 "modified_by": "Administrator",
 "module": "Singapore L10N",
 "name": "GST Detail Report",
 "owner": "administrator",
 "prepared_report": 0,
 "ref_doctype": "Sales Invoice",
 "report_name": "GST Detail Report",
 "report_script": "out_data = []\nsgst_details = frappe.db.get_all('SGST Detail', {'parent': 'Singapore GST Settings', 'company':filters.company}, ['box_1', 'box_2', 'box_3'])\nif sgst_details and (sgst_details[0].get('box_1') or sgst_details[0].get('box_2') or sgst_details[0].get('box_3')):\n\tquery = f'''\n    SELECT\n\t\tsi.posting_date AS date,\n\t\t'Sales Invoice' AS transaction_type,\n\t\tsi.name AS name,\n\t\tsi.customer_name AS party_name,\n\t\tst.account_head AS gst_code,\n\t\tst.rate as gst_rate,\n\t\tst.base_total as net_amount,\n\t\tst.base_tax_amount as amount,\n\t\tsi.total as taxless_total\n\t\t\n    FROM\n\t\t`tabSales Invoice` AS si,\n\t\t`tabSales Taxes and Charges` AS st\n    WHERE\n\t\t  st.parent=si.name\n\t\t'''\n\tif filters.company:\n\t\tquery = f\"{query} AND si.company='{filters.company}'\"\n\tfrom_date = filters.get('from_date')\n\tto_date = filters.get('to_date')\n\tif from_date and to_date:\n\t\tquery = f\"{query} AND si.posting_date BETWEEN '{from_date}' AND '{to_date}'\"\n\tquery = f\"{query} ORDER By si.name\"\n\tsql_data= frappe.db.sql(f\"{query}\", as_dict=True)\n\tbox_1 = [{'transaction_type':'Box 1 Total value of standard-rated supplies (excluding GST)', 'heading':1}]\n\tbox_2 = [{'transaction_type':'Box 2 Total value of standard-rated supplies (excluding GST)', 'heading':1}]\n\tbox_3 = [{'transaction_type':'Box 3 Total value of standard-rated supplies (excluding GST)', 'heading':1}]\n\tout_data = []\n\tsales_invoice_with_tax = []\n\tsales_invoice_with_tax_total = 0\n\tbox_1_total = 0\n\tbox_2_total = 0\n\tbox_3_total = 0\n\tbox_1_balance_total = 0\n\tbox_2_balance_total = 0\n\tbox_3_balance_total = 0\n\tbox_6_balance_total = 0\n\ttotal = 0\n\tif sql_data:\n\t\tcp_sqldata = sql_data.copy()\n\t\tfor data in cp_sqldata:\n\t\t\tif data.get('gst_code') in [sgst_details[0].get('box_1'), sgst_details[0].get('box_2'), sgst_details[0].get('box_3')]:\n\t\t\t\tsales_invoice_with_tax_total = sales_invoice_with_tax_total + data['amount']\n\t\t\t\tbox_6_balance_total = box_6_balance_total+data.get('amount')\n\t\t\t\tdata['balance'] = box_6_balance_total\n\t\t\t\tsales_invoice_with_tax.append(data)\n\t\t\tcp_dict=data.copy()\n\t\t\tcp_dict['gst_rate'] = 0,\n\t\t\tcp_dict['net_amount'] = 0,\n\t\t\tcp_dict['amount']=cp_dict['taxless_total']\n\t\t\tif data.get('gst_code') == sgst_details[0].get('box_1'):\n\t\t\t\ttotal = total + cp_dict.get('amount')\n\t\t\t\tbox_1_total = box_1_total + cp_dict.get('amount')\n\t\t\t\tbox_1_balance_total = box_1_balance_total+cp_dict.get('amount')\n\t\t\t\tcp_dict['balance'] = box_1_balance_total\n\t\t\t\tbox_1.append(cp_dict)\n\t\t\telif data.get('gst_code') == sgst_details[0].get('box_2'):\n\t\t\t\ttotal = total + cp_dict.get('amount')\n\t\t\t\tbox_2_balance_total = box_2_balance_total+cp_dict.get('amount')\n\t\t\t\tcp_dict['balance'] = box_2_balance_total\n\t\t\t\tbox_2.append(cp_dict)\n\t\t\t\tbox_2_total = box_2_total + cp_dict.get('amount')\n\t\t\telif data.get('gst_code') == sgst_details[0].get('box_3'):\n\t\t\t\ttotal = total + cp_dict.get('amount')\n\t\t\t\tbox_3_balance_total = box_3_balance_total+cp_dict.get('amount')\n\t\t\t\tcp_dict['balance'] = box_3_balance_total\n\t\t\t\tbox_3.append(cp_dict)\n\t\t\t\tbox_3_total = box_3_total + cp_dict.get('amount')\n\t\tbox_1_total_line = [{'transaction_type':'<b>Box 1 Total value of standard-rated supplies (excluding GST)</b>', 'heading':1, 'amount': box_1_total}]\n\t\tbox_2_total_line = [{'transaction_type':'<b>Box 2 Total value of standard-rated supplies (excluding GST)</b>', 'heading':1, 'amount': box_2_total}]\n\t\tbox_3_total_line = [{'transaction_type':'<b>Box 3 Total value of standard-rated supplies (excluding GST)</b>', 'heading':1, 'amount': box_3_total}]\n\t\tout_data = box_1 + box_1_total_line + box_2 + box_2_total_line + box_3 + box_3_total_line\n\tout_data = out_data + [{'transaction_type':'<b>Box 4 Total (Box 1, Box 2, Box 3)</b>', 'heading':1, 'amount':total}]\n\t\n\t\n\tpi_query = f'''\n\t  SELECT\n\t\t  p.posting_date AS date,\n\t\t  'Purchase Invoice' AS transaction_type,\n\t\tp.name AS name,\n\t\tp.supplier_name AS party_name,\n\t\tpt.account_head AS gst_code,\n\t\tpt.rate as gst_rate,\n\t\tpt.base_total as net_amount,\n\t\tpt.base_tax_amount as amount,\n\t\tp.total as taxless_total\n\t\t\n\t  FROM\n\t\t`tabPurchase Invoice` AS p,\n\t\t`tabPurchase Taxes and Charges` AS pt\n\t  WHERE\n\t\t  pt.parent=p.name'''\n\tif filters.company:\n\t\tpi_query = f\"{pi_query} AND p.company='{filters.company}'\"\n\tif from_date and to_date:\n\t\tpi_query = f\"{pi_query} AND p.posting_date BETWEEN '{from_date}' AND '{to_date}'\"\n\tquery = f\"{pi_query} ORDER By p.name\"\n\t\n\tp_sql_data= frappe.db.sql(f\"{pi_query}\", as_dict=True)\n\tbox_5_balance_total = 0\n\tbox_7_balance_total = 0\n\tbox_5 = [{'transaction_type':'<b>Total for Box 5 Total value of taxable purchases (excluding GST)</b>', 'heading':1}]\n\tp_total = 0\n\tpurchase_row_without_gst = []\n\tpurchase_invoice_with_tax = []\n\tpurchase_invoice_with_tax_total = 0\n\tif p_sql_data:\n\t\tout_data = out_data + [{'transaction_type':'Box 5 Total value of taxable purchases (excluding GST)', 'heading':1}]\n\t\tcp_sqldata = p_sql_data.copy()\n\t\tfor data in cp_sqldata:\n\t\t\tif data.get('gst_code') in [sgst_details[0].get('box_1'), sgst_details[0].get('box_2'), sgst_details[0].get('box_3')]:\n\t\t\t\tpurchase_invoice_with_tax_total = purchase_invoice_with_tax_total + data['amount']\n\t\t\t\tbox_7_balance_total = box_7_balance_total+data.get('amount')\n\t\t\t\tdata['balance'] = box_7_balance_total\n\t\t\t\tpurchase_invoice_with_tax.append(data)\n\t\t\t\tcp_dict=data.copy()\n\t\t\t\tcp_dict['gst_rate'] = 0,\n\t\t\t\tcp_dict['net_amount'] = 0,\n\t\t\t\tcp_dict['amount']=cp_dict['taxless_total']\n\t\t\t\tbox_5_balance_total = box_5_balance_total+cp_dict.get('amount')\n\t\t\t\tcp_dict['balance'] = box_5_balance_total\n\t\t\t\tpurchase_row_without_gst.append(cp_dict)\n\t\t\t\tp_total = p_total + cp_dict.get('amount')\n\t\tbox_5[0]['amount'] = p_total\n\t\tout_data = out_data+purchase_row_without_gst+box_5\n\tif sales_invoice_with_tax:\n\t\tout_data = out_data + [{'transaction_type':'Box 6 Output tax due', 'heading':1}] + sales_invoice_with_tax + \\\n\t\t[{'transaction_type':'<b>Total for Box 6 Output tax due</b>', 'heading':1, 'amount':sales_invoice_with_tax_total}]\n\tif purchase_invoice_with_tax:\n\t\tout_data = out_data + [{'transaction_type':'Box 7 Input tax and refunds claimed', 'heading':1}] + purchase_invoice_with_tax + \\\n\t\t[{'transaction_type':'<b>Total for Box 7 Input tax and refunds claimed</b>', 'heading':1, 'amount':purchase_invoice_with_tax_total}]\n\tbox_8 = []\n\tif purchase_invoice_with_tax_total and sales_invoice_with_tax_total:\n\t\tif sales_invoice_with_tax_total > purchase_invoice_with_tax_total:\n\t\t\tbox_8 = [{'transaction_type':'<b>Box 8 Tax To Be Paid</b>', 'heading':1, 'amount': sales_invoice_with_tax_total-purchase_invoice_with_tax_total}]\n\t\telif sales_invoice_with_tax_total < purchase_invoice_with_tax_total:\n\t\t\tbox_8 = [{'transaction_type':'<b>Box 8 Tax To Be Claimed</b>', 'heading':1, 'amount': purchase_invoice_with_tax_total-sales_invoice_with_tax_total}]\n\t\telif sales_invoice_with_tax_total == purchase_invoice_with_tax_total:\n\t\t\tbox_8 = [{'transaction_type':'<b>Box 8 Tax</b>', 'heading':1, 'amount': purchase_invoice_with_tax_total}]\n\t\tout_data = out_data + box_8\ncolumn = [\n  {\n\t'fieldname': 'transaction_type',\n\t'label': _('TRANSACTION TYPE'),\n\t'fieldtype': 'Data',\n\t'width': 420\n  },\n\t{\n\t'fieldname': 'date',\n\t'label': _('DATE'),\n\t'fieldtype': 'Date',\n\t'width': 100\n  },\n  {\n\t'fieldname': 'name',\n\t'label': _('NO'),\n\t'fieldtype': 'Data',\n\t'width': 180\n  },\n  {\n\t'fieldname': 'party_name',\n\t'label': _('NAME'),\n\t'fieldtype': 'Data',\n\t'width': 150\n  },\n  \n  {\n\t'fieldname': 'gst_code',\n\t'label': _('GST CODE'),\n\t'fieldtype': 'Link',\n\t'options': 'Account',\n\t'width': 100\n  },\n  {\n\t'fieldname': 'gst_rate',\n\t'label': _('GST RATE'),\n\t'fieldtype': 'Data',\n\t  'width': 100\n  },\n  {\n\t'fieldname': 'net_amount',\n\t'label': _('NET AMOUNT'),\n\t'fieldtype': 'Currency',\n\t  'width': 100\n  },\n  {\n\t'fieldname': 'amount',\n\t'label': _('AMOUNT'),\n\t'fieldtype': 'Currency',\n\t  'width': 100\n  },\n  {\n\t'fieldname': 'balance',\n\t'label': _('BALANCE'),\n\t'fieldtype': 'Currency',\n\t  'width': 100\n  }]\n\ndata = column, out_data",
 "report_type": "Script Report",
 "roles": [
  {
   "role": "Accounts User"
  },
  {
   "role": "Accounts Manager"
  },
  {
   "role": "Employee Self Service"
  }
 ]
}